/*
 * logger-request v2.2.4
 * (c) hex7c0 http://supergiovane.tk/#/logger-request
 * Licensed under GPLv3
 */
"use strict";function wrapper(a,b){function c(a){var b=Object.create(null),c=new Array;return a.pid&&c.push(["pid",function(){return process.pid}]),a.bytesReq&&c.push(["bytesReq",function(a){return a.socket.bytesRead}]),a.bytesRes&&c.push(["bytesRes",function(a){return a.socket._bytesDispatched}]),a.referrer&&c.push(["referrer",function(a){return a.headers.referer||a.headers.referrer}]),a.auth&&(e=require("basic-authentication")({legacy:!0}),c.push(["auth",function(a){return e(a).user}])),a.agent&&c.push(["agent",function(a){return a.headers["user-agent"]}]),a.lang&&c.push(["lang",function(a){return a.headers["accept-language"]}]),a.cookie&&c.push(["cookie",function(a){return a.cookies}]),a.cookie&&c.push(["headers",function(a){return a.headers}]),a.version&&c.push(["version",function(a){return a.httpVersionMajor+"."+a.httpVersionMinor}]),function(a,d,e){a=a.req||a,b.ip=a.headers["x-forwarded-for"]||a.ip,b.method=a.method,b.status=d,b.url=a.url,b.response=e.toFixed(3);for(var f=0,g=c.length;g>f;f++){var h=c[f];b[h[0]]=h[1](a)}return b}}function d(b,c,d){var e=process.hrtime(d);return a(f,g(b,c,(1e9*e[0]+e[1])/1e6))}var e,f=b.logger,g=c(b.custom);return function(a,b,c){var e=process.hrtime();if(b._headerSent)d(a,b.statusCode,e);else{var f=b.end,g=d;b.end=function(c,d){b.end=f;var h=b.end(c,d);return g(a,b.statusCode,e),h}}try{return c()}catch(h){return}}}module.exports=function(a){var a=a||Object.create(null),b={console:!Boolean(a.console),filename:require("path").resolve(String(a.filename||"route.log"))};a.winston=a.winston||Object.create(null);var c={filename:b.filename,logger:String(a.winston.logger||"logger-request"),level:String(a.winston.level||"info"),silent:Boolean(a.winston.silent),colorize:Boolean(a.winston.colorize),timestamp:a.winston.timestamp||!0,maxsize:Number(a.winston.maxsize)||8388608,maxFiles:Number(a.winston.maxFiles)||null,json:0==a.winston.json?!1:!0,raw:0==a.winston.raw?!1:!0};b.logger=c.logger;var d=require("winston").loggers.add(c.logger,{console:{level:c.level,silent:b.console,colorize:c.colorize,timestamp:c.timestamp,json:c.json,raw:c.raw},file:{level:c.level,silent:c.silent,colorize:c.colorize,timestamp:c.timestamp,filename:c.filename,maxsize:c.maxsize,maxFiles:c.maxFiles,json:c.json}})[c.level];return Boolean(a.standalone)?d:(a=a.custom||Object.create(null),b.custom={pid:Boolean(a.pid),bytesReq:Boolean(a.bytesReq),bytesRes:Boolean(a.bytesRes),referrer:Boolean(a.referrer),auth:Boolean(a.auth),agent:Boolean(a.agent),lang:Boolean(a.lang),cookie:Boolean(a.cookie),headers:Boolean(a.headers),version:Boolean(a.version)},wrapper(d,b))};
