"use strict";function info(a){var b=Array.call();if(a.pid&&b.push(["pid",function(){return process.pid}]),a.bytesReq&&b.push(["bytesReq",function(a){return a.socket.bytesRead}]),a.bytesRes&&b.push(["bytesRes",function(a){return a.socket._bytesDispatched}]),a.referrer&&b.push(["referrer",function(a){return a.headers.referer||a.headers.referrer}]),a.auth){var c=require("basic-authentication")({legacy:!0});b.push(["auth",function(a){return c(a).user}])}if(a.transfer){var d=require("transfer-rate")();b.push(["transfer",function(a){return d(a,a.start)}])}a.agent&&b.push(["agent",function(a){return a.headers["user-agent"]}]),a.lang&&b.push(["lang",function(a){return a.headers["accept-language"]}]),a.cookie&&b.push(["cookie",function(a){return a.cookies}]),a.cookie&&b.push(["headers",function(a){return a.headers}]),a.version&&b.push(["version",function(a){return a.httpVersionMajor+"."+a.httpVersionMinor}]),a.callback&&b.push(["callback",function(b){return a.callback(b)}]);var e=b.length;return function(a,c,d){for(var f=(1e9*d[0]+d[1])/1e6,g={ip:a.remoteAddr,method:a.method,status:c,url:a.url,response:f.toFixed(2)},h=0;e>h;h++){var i=b[h];g[i[0]]=i[1](a)}return g}}function wrapper(a,b,c){function d(d,e,f){var g=process.hrtime(f);return d.start=f,a(b.logger,c(d,e,g))}return b.deprecated?(console.error("warning! `logger-request` option is deprecated"),function(a,b,c){var e=process.hrtime();if(a.remoteAddr=a.headers["x-forwarded-for"]||a.ip,b._headerSent)d(a,b.statusCode,e);else{var f=b.end;b.end=function(c,g){b.end=f;var h=b.end(c,g);return d(a,b.statusCode,e),h}}return c?c():void 0}):b.functions?function(a,b){a.remoteAddr=a.headers["x-forwarded-for"]||a.ip;var c=process.hrtime();return d(a,b.statusCode,c)}:function(a,b,c){var e;return a.remoteAddr=a.headers["x-forwarded-for"]||a.ip,finished(b,function(){return d(a,b.statusCode,e)}),e=process.hrtime(),c()}}function logger(a){var b=a||Object.create(null),c={filename:require("path").resolve(String(b.filename||"route.log"))};Boolean(b.deprecated)?c.deprecated=!0:Boolean(b.functions)&&(c.functions=!0),b.winston=b.winston||Object.create(null);var d={filename:c.filename,logger:String(b.winston.logger||"logger-request"),level:String(b.winston.level||"info"),silent:Boolean(b.winston.silent),colorize:Boolean(b.winston.colorize),timestamp:b.winston.timestamp||!0,maxsize:Number(b.winston.maxsize)||8388608,maxFiles:Number(b.winston.maxFiles)||null,json:b.winston.json===!1?!1:!0,raw:b.winston.raw===!1?!1:!0};c.logger=d.logger;var e=require("winston").loggers.add(d.logger,{console:{level:d.level,silent:!Boolean(b.console),colorize:d.colorize,timestamp:d.timestamp,json:d.json,raw:d.raw},file:{level:d.level,silent:d.silent,colorize:d.colorize,timestamp:d.timestamp,filename:d.filename,maxsize:d.maxsize,maxFiles:d.maxFiles,json:d.json}})[d.level];if(Boolean(b.standalone))return e;b=b.custom||Object.create(null);var f=info({pid:Boolean(b.pid),bytesReq:Boolean(b.bytesReq),bytesRes:Boolean(b.bytesRes),referrer:Boolean(b.referrer),auth:Boolean(b.auth),transfer:Boolean(b.transfer),agent:Boolean(b.agent),lang:Boolean(b.lang),cookie:Boolean(b.cookie),headers:Boolean(b.headers),version:Boolean(b.version),callback:Boolean(b.callback)?b.callback:!1});return wrapper(e,c,f)}try{var finished=require("on-finished")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=logger;
