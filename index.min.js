/*
 * logger-request v3.0.0
 * (c) hex7c0 http://supergiovane.tk/#/logger-request
 * Licensed under GPLv3
 */
"use strict";function info(a){var b=Object.create(null),c=new Array;if(a.pid&&c.push(["pid",function(){return process.pid}]),a.bytesReq&&c.push(["bytesReq",function(a){return a.socket.bytesRead}]),a.bytesRes&&c.push(["bytesRes",function(a){return a.socket._bytesDispatched}]),a.referrer&&c.push(["referrer",function(a){return a.headers.referer||a.headers.referrer}]),a.auth){var d=require("basic-authentication")({legacy:!0});c.push(["auth",function(a){return d(a).user}])}return a.agent&&c.push(["agent",function(a){return a.headers["user-agent"]}]),a.lang&&c.push(["lang",function(a){return a.headers["accept-language"]}]),a.cookie&&c.push(["cookie",function(a){return a.cookies}]),a.cookie&&c.push(["headers",function(a){return a.headers}]),a.version&&c.push(["version",function(a){return a.httpVersionMajor+"."+a.httpVersionMinor}]),function(a,d,e){b.ip=a.headers["x-forwarded-for"]||a.ip||"next",b.method=a.method,b.status=d,b.url=a.url,b.response=e.toFixed(3);for(var f=0,g=c.length;g>f;f++){var h=c[f];b[h[0]]=h[1](a)}return b}}function wrapper(a,b){function c(b,c,f){var g=process.hrtime(f);return a(d,e(b,c,(1e9*g[0]+g[1])/1e6))}var d=b.logger,e=info(b.custom);return b.deprecated?(console.error("warning! `logger-request` option is deprecated"),function(a,b,d){var e=process.hrtime();if(b._headerSent)c(a,b.statusCode,e);else{var f=b.end,g=c;b.end=function(c,d){b.end=f;var h=b.end(c,d);return g(a,b.statusCode,e),h}}try{return d()}catch(h){return}}):function(a,b,d){var e=process.hrtime();b._headerSent?c(a,b.statusCode,e):finished(b,function(){c(a,b.statusCode,e)});try{return d()}catch(f){return}}}try{var finished=require("finished")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=function(a){var a=a||Object.create(null),b={console:!Boolean(a.console),filename:require("path").resolve(String(a.filename||"route.log")),deprecated:Boolean(a.deprecated)};a.winston=a.winston||Object.create(null);var c={filename:b.filename,logger:String(a.winston.logger||"logger-request"),level:String(a.winston.level||"info"),silent:Boolean(a.winston.silent),colorize:Boolean(a.winston.colorize),timestamp:a.winston.timestamp||!0,maxsize:Number(a.winston.maxsize)||8388608,maxFiles:Number(a.winston.maxFiles)||null,json:0==a.winston.json?!1:!0,raw:0==a.winston.raw?!1:!0};b.logger=c.logger;var d=require("winston").loggers.add(c.logger,{console:{level:c.level,silent:b.console,colorize:c.colorize,timestamp:c.timestamp,json:c.json,raw:c.raw},file:{level:c.level,silent:c.silent,colorize:c.colorize,timestamp:c.timestamp,filename:c.filename,maxsize:c.maxsize,maxFiles:c.maxFiles,json:c.json}})[c.level];return Boolean(a.standalone)?d:(a=a.custom||Object.create(null),b.custom={pid:Boolean(a.pid),bytesReq:Boolean(a.bytesReq),bytesRes:Boolean(a.bytesRes),referrer:Boolean(a.referrer),auth:Boolean(a.auth),agent:Boolean(a.agent),lang:Boolean(a.lang),cookie:Boolean(a.cookie),headers:Boolean(a.headers),version:Boolean(a.version)},wrapper(d,b))};
