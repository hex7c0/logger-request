/*
 * logger-request v2.2.1
 * (c) hex7c0 https://github.com/hex7c0/logger-request/
 * Licensed under GPLv3
 */
"use strict";function wrapper(a,b){function c(a){var b=Object.create(null),c=new Array;return a.pid&&c.push(["pid",function(){return process.pid}]),a.bytesReq&&c.push(["bytesReq",function(a){var b=a.socket.bytesRead-h;return h=a.socket.bytesRead,b}]),a.bytesRes&&c.push(["bytesRes",function(a){var b=a.socket._bytesDispatched-i;return i=a.socket._bytesDispatched,b}]),a.referrer&&c.push(["referrer",function(a){return a.headers.referer||a.headers.referrer}]),a.auth&&(e=require("basic-authentication")({legacy:!0}),c.push(["auth",function(a){return e(a).user}])),a.agent&&c.push(["agent",function(a){return a.headers["user-agent"]}]),a.lang&&c.push(["lang",function(a){return a.headers["accept-language"]}]),a.cookie&&c.push(["cookie",function(a){return a.cookies}]),a.version&&c.push(["version",function(a){return a.httpVersionMajor+"."+a.httpVersionMinor}]),function(a,d,e){a=a.req||a,b.ip=a.headers["x-forwarded-for"]||a.ip||a.connection.reqmoteAddreqss,b.method=a.method,b.status=d,b.url=a.url,b.response=e.toFixed(3);for(var f=0,g=c.length;g>f;f++){var h=c[f];b[h[0]]=h[1](a)}return b}}function d(b,c,d){var e=process.hrtime(d);return a(f,g(b,c,(1e9*e[0]+e[1])/1e6))}var e,f=b.winston.logger,g=c(b.custom),h=0,i=0;return function(a,b,c){var e=process.hrtime();if(b._headerSent)d(a,b.statusCode,e);else{var f=b.end,g=d;b.end=function(c,d){b.end=f;var h=b.end(c,d);return g(a,b.statusCode,e),h}}try{return c()}catch(h){return}}}module.exports=function(a){var a=a||Object.create(null),b={console:!Boolean(a.console),filename:require("path").resolve(String(a.filename||"route.log"))};a.winston=a.winston||Object.create(null),b.winston={logger:String(a.winston.logger||"logger-request"),level:String(a.winston.level||"info"),silent:Boolean(a.winston.silent),colorize:Boolean(a.winston.colorize),timestamp:a.winston.timestamp||!0,maxsize:Number(a.winston.maxsize)||8388608,maxFiles:Number(a.winston.maxFiles)||null,json:0==a.winston.json?!1:!0,raw:0==a.winston.raw?!1:!0};var c=require("winston").loggers.add(b.winston.logger,{console:{level:b.winston.level,silent:b.console,colorize:b.winston.colorize,timestamp:b.winston.timestamp,json:b.winston.json,raw:b.winston.raw},file:{level:b.winston.level,silent:b.winston.silent,colorize:b.winston.colorize,timestamp:b.winston.timestamp,filename:b.filename,maxsize:b.winston.maxsize,maxFiles:b.winston.maxFiles,json:b.winston.json}})[b.winston.level];return Boolean(a.standalone)?c:(a=a.custom||Object.create(null),b.custom={pid:Boolean(a.pid),bytesReq:Boolean(a.bytesReq),bytesRes:Boolean(a.bytesRes),referrer:Boolean(a.referrer),auth:Boolean(a.auth),agent:Boolean(a.agent),lang:Boolean(a.lang),cookie:Boolean(a.cookie),version:Boolean(a.version)},wrapper(c,b))};