"use strict";function info(a){var b=Object.create(null),c=[];if(a.pid&&c.push(["pid",function(){return process.pid}]),a.bytesReq&&c.push(["bytesReq",function(a){return a.socket.bytesRead}]),a.bytesRes&&c.push(["bytesRes",function(a){return a.socket._bytesDispatched}]),a.referrer&&c.push(["referrer",function(a){return a.headers.referer||a.headers.referrer}]),a.auth){var d=require("basic-authentication")({legacy:!0});c.push(["auth",function(a){return d(a).user}])}return a.agent&&c.push(["agent",function(a){return a.headers["user-agent"]}]),a.lang&&c.push(["lang",function(a){return a.headers["accept-language"]}]),a.cookie&&c.push(["cookie",function(a){return a.cookies}]),a.cookie&&c.push(["headers",function(a){return a.headers}]),a.version&&c.push(["version",function(a){return a.httpVersionMajor+"."+a.httpVersionMinor}]),function(a,d,e){b.ip=a.remoteAddr,b.method=a.method,b.status=d,b.url=a.url,b.response=e.toFixed(3);for(var f=0,g=c.length;g>f;f++){var h=c[f];b[h[0]]=h[1](a)}return b}}function wrapper(a,b){function c(b,c,f){var g=process.hrtime(f);return a(d,e(b,Number(c),(1e9*g[0]+g[1])/1e6))}var d=b.logger,e=info(b.custom);return b.deprecated?(console.error("warning! `logger-request` option is deprecated"),function(a,b,d){var e=process.hrtime();if(a.remoteAddr=a.headers["x-forwarded-for"]||a.ip,b._headerSent)c(a,b.statusCode,e);else{var f=b.end;b.end=function(d,g){b.end=f;var h=b.end(d,g);return c(a,b.statusCode,e),h}}return d?d():void 0}):function(a,b,d){a.remoteAddr=a.headers["x-forwarded-for"]||a.ip;var e=process.hrtime();return b._headerSent?c(a,b.statusCode,e):finished(b,function(){return c(a,b.statusCode,e)}),d()}}function logger(a){var b=a||Object.create(null),c={console:!Boolean(b.console),filename:require("path").resolve(String(b.filename||"route.log")),deprecated:Boolean(b.deprecated)};b.winston=b.winston||Object.create(null);var d={filename:c.filename,logger:String(b.winston.logger||"logger-request"),level:String(b.winston.level||"info"),silent:Boolean(b.winston.silent),colorize:Boolean(b.winston.colorize),timestamp:b.winston.timestamp||!0,maxsize:Number(b.winston.maxsize)||8388608,maxFiles:Number(b.winston.maxFiles)||null,json:b.winston.json===!1?!1:!0,raw:b.winston.raw===!1?!1:!0};c.logger=d.logger;var e=require("winston").loggers.add(d.logger,{console:{level:d.level,silent:c.console,colorize:d.colorize,timestamp:d.timestamp,json:d.json,raw:d.raw},file:{level:d.level,silent:d.silent,colorize:d.colorize,timestamp:d.timestamp,filename:d.filename,maxsize:d.maxsize,maxFiles:d.maxFiles,json:d.json}})[d.level];return Boolean(b.standalone)?e:(b=b.custom||Object.create(null),c.custom={pid:Boolean(b.pid),bytesReq:Boolean(b.bytesReq),bytesRes:Boolean(b.bytesRes),referrer:Boolean(b.referrer),auth:Boolean(b.auth),agent:Boolean(b.agent),lang:Boolean(b.lang),cookie:Boolean(b.cookie),headers:Boolean(b.headers),version:Boolean(b.version)},wrapper(e,c))}try{var finished=require("on-finished")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}module.exports=logger;
